---
layout: inner_post
title:  "EDA on MoA"
date:   2021-02-22 17:15:08 +0530
category: ML_insider
---
## EDA of LISH MoA dataset

#### Importing libraries for EDA
```python
# import libraries for EDA
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import matplotlib.patches as mpatches
import matplotlib.colors as colors
from matplotlib.pyplot import imshow
from IPython.display import display
import seaborn as sns
from PIL import Image
```

#### Dataset files description

- **train_features.csv** - Features for the training set. Features **g-** signify gene expression data, and **c-** signify cell viability data. cp_type indicates samples treated with a compound (cp_vehicle) or with a control perturbation (ctrl_vehicle); control perturbations have no MoAs; cp_time and cp_dose indicate treatment duration (24, 48, 72 hours) and dose (high or low).

- **train_drug.csv** - This file contains an anonymous drug_id for the training set only.

- **train_targets_scored.csv** - The binary MoA targets that are scored (i-e Prediction of these targets will be taken into consideration).

- **train_targets_nonscored.csv** - Additional (optional) binary MoA responses for the training data. Prediction of these targets will not be taken into consideration.

- **test_features.csv** - Features for the test data. You must predict the probability of each scored MoA for each row in the test data.

- **sample_submission.csv** - A submission file in the correct format.

```python
#let's read the feature file 
features = pd.read_csv('train_features.csv')
```

```python
features.head()
```

<div style="overflow-x: scroll;" >
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sig_id</th>
      <th>cp_type</th>
      <th>cp_time</th>
      <th>cp_dose</th>
      <th>g-0</th>
      <th>g-1</th>
      <th>g-2</th>
      <th>g-3</th>
      <th>g-4</th>
      <th>g-5</th>
      <th>...</th>
      <th>c-90</th>
      <th>c-91</th>
      <th>c-92</th>
      <th>c-93</th>
      <th>c-94</th>
      <th>c-95</th>
      <th>c-96</th>
      <th>c-97</th>
      <th>c-98</th>
      <th>c-99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_000644bb2</td>
      <td>trt_cp</td>
      <td>24</td>
      <td>D1</td>
      <td>1.0620</td>
      <td>0.5577</td>
      <td>-0.2479</td>
      <td>-0.6208</td>
      <td>-0.1944</td>
      <td>-1.0120</td>
      <td>...</td>
      <td>0.2862</td>
      <td>0.2584</td>
      <td>0.8076</td>
      <td>0.5523</td>
      <td>-0.1912</td>
      <td>0.6584</td>
      <td>-0.3981</td>
      <td>0.2139</td>
      <td>0.3801</td>
      <td>0.4176</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_000779bfc</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D1</td>
      <td>0.0743</td>
      <td>0.4087</td>
      <td>0.2991</td>
      <td>0.0604</td>
      <td>1.0190</td>
      <td>0.5207</td>
      <td>...</td>
      <td>-0.4265</td>
      <td>0.7543</td>
      <td>0.4708</td>
      <td>0.0230</td>
      <td>0.2957</td>
      <td>0.4899</td>
      <td>0.1522</td>
      <td>0.1241</td>
      <td>0.6077</td>
      <td>0.7371</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_000a6266a</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>0.6280</td>
      <td>0.5817</td>
      <td>1.5540</td>
      <td>-0.0764</td>
      <td>-0.0323</td>
      <td>1.2390</td>
      <td>...</td>
      <td>-0.7250</td>
      <td>-0.6297</td>
      <td>0.6103</td>
      <td>0.0223</td>
      <td>-1.3240</td>
      <td>-0.3174</td>
      <td>-0.6417</td>
      <td>-0.2187</td>
      <td>-1.4080</td>
      <td>0.6931</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_0015fd391</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>-0.5138</td>
      <td>-0.2491</td>
      <td>-0.2656</td>
      <td>0.5288</td>
      <td>4.0620</td>
      <td>-0.8095</td>
      <td>...</td>
      <td>-2.0990</td>
      <td>-0.6441</td>
      <td>-5.6300</td>
      <td>-1.3780</td>
      <td>-0.8632</td>
      <td>-1.2880</td>
      <td>-1.6210</td>
      <td>-0.8784</td>
      <td>-0.3876</td>
      <td>-0.8154</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_001626bd3</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D2</td>
      <td>-0.3254</td>
      <td>-0.4009</td>
      <td>0.9700</td>
      <td>0.6919</td>
      <td>1.4180</td>
      <td>-0.8244</td>
      <td>...</td>
      <td>0.0042</td>
      <td>0.0048</td>
      <td>0.6670</td>
      <td>1.0690</td>
      <td>0.5523</td>
      <td>-0.3031</td>
      <td>0.1094</td>
      <td>0.2885</td>
      <td>-0.3786</td>
      <td>0.7125</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 876 columns</p>
</div>



    There are 23814 experiment results and 876 features



```python
#let's read the target scored file
targets_scored = pd.read_csv('train_targets_scored.csv')
```

It is called as target scored file because, predictions of these targets will be taken into consideration while computing loss.  


```python
targets_scored.head()
```

<div style="overflow-x: scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sig_id</th>
      <th>5-alpha_reductase_inhibitor</th>
      <th>11-beta-hsd1_inhibitor</th>
      <th>acat_inhibitor</th>
      <th>acetylcholine_receptor_agonist</th>
      <th>acetylcholine_receptor_antagonist</th>
      <th>acetylcholinesterase_inhibitor</th>
      <th>adenosine_receptor_agonist</th>
      <th>adenosine_receptor_antagonist</th>
      <th>adenylyl_cyclase_activator</th>
      <th>...</th>
      <th>tropomyosin_receptor_kinase_inhibitor</th>
      <th>trpv_agonist</th>
      <th>trpv_antagonist</th>
      <th>tubulin_inhibitor</th>
      <th>tyrosine_kinase_inhibitor</th>
      <th>ubiquitin_specific_protease_inhibitor</th>
      <th>vegfr_inhibitor</th>
      <th>vitamin_b</th>
      <th>vitamin_d_receptor_agonist</th>
      <th>wnt_inhibitor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_000644bb2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_000779bfc</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_000a6266a</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_0015fd391</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_001626bd3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 207 columns</p>
</div>



    There are 23814 experiment results and 207 scored MoA's



```python
#let's read the target non-scored file
targets_non_scored = pd.read_csv('train_targets_nonscored.csv')
```

It is called as target non-scored file because, predictions of these targets will not be taken while computing loss. 


```python
targets_non_scored.head()
```
<div style="overflow-x: scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sig_id</th>
      <th>abc_transporter_expression_enhancer</th>
      <th>abl_inhibitor</th>
      <th>ace_inhibitor</th>
      <th>acetylcholine_release_enhancer</th>
      <th>adenosine_deaminase_inhibitor</th>
      <th>adenosine_kinase_inhibitor</th>
      <th>adenylyl_cyclase_inhibitor</th>
      <th>age_inhibitor</th>
      <th>alcohol_dehydrogenase_inhibitor</th>
      <th>...</th>
      <th>ve-cadherin_antagonist</th>
      <th>vesicular_monoamine_transporter_inhibitor</th>
      <th>vitamin_k_antagonist</th>
      <th>voltage-gated_calcium_channel_ligand</th>
      <th>voltage-gated_potassium_channel_activator</th>
      <th>voltage-gated_sodium_channel_blocker</th>
      <th>wdr5_mll_interaction_inhibitor</th>
      <th>wnt_agonist</th>
      <th>xanthine_oxidase_inhibitor</th>
      <th>xiap_inhibitor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_000644bb2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_000779bfc</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_000a6266a</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_0015fd391</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_001626bd3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 403 columns</p>
</div>



    There are 23814 experiment results and 403 non-scored MoA's


# 1. Introduction and inspection of train and test columns

#### 1.1  Inspection of train columns / features


```python
features.columns
```




    Index(['sig_id', 'cp_type', 'cp_time', 'cp_dose', 'g-0', 'g-1', 'g-2', 'g-3',
           'g-4', 'g-5',
           ...
           'c-90', 'c-91', 'c-92', 'c-93', 'c-94', 'c-95', 'c-96', 'c-97', 'c-98',
           'c-99'],
          dtype='object', length=876)




```python
# total number of columns
print('Number of columns {}'.format(len(features.columns)))
```

    Number of columns 876


So there are total 875 features one of the column has unique identifiers for each row.
The breakdown of features is as follows.



```python
features.head()
```

<div style="overflow-x: scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sig_id</th>
      <th>cp_type</th>
      <th>cp_time</th>
      <th>cp_dose</th>
      <th>g-0</th>
      <th>g-1</th>
      <th>g-2</th>
      <th>g-3</th>
      <th>g-4</th>
      <th>g-5</th>
      <th>...</th>
      <th>c-90</th>
      <th>c-91</th>
      <th>c-92</th>
      <th>c-93</th>
      <th>c-94</th>
      <th>c-95</th>
      <th>c-96</th>
      <th>c-97</th>
      <th>c-98</th>
      <th>c-99</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_000644bb2</td>
      <td>trt_cp</td>
      <td>24</td>
      <td>D1</td>
      <td>1.0620</td>
      <td>0.5577</td>
      <td>-0.2479</td>
      <td>-0.6208</td>
      <td>-0.1944</td>
      <td>-1.0120</td>
      <td>...</td>
      <td>0.2862</td>
      <td>0.2584</td>
      <td>0.8076</td>
      <td>0.5523</td>
      <td>-0.1912</td>
      <td>0.6584</td>
      <td>-0.3981</td>
      <td>0.2139</td>
      <td>0.3801</td>
      <td>0.4176</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_000779bfc</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D1</td>
      <td>0.0743</td>
      <td>0.4087</td>
      <td>0.2991</td>
      <td>0.0604</td>
      <td>1.0190</td>
      <td>0.5207</td>
      <td>...</td>
      <td>-0.4265</td>
      <td>0.7543</td>
      <td>0.4708</td>
      <td>0.0230</td>
      <td>0.2957</td>
      <td>0.4899</td>
      <td>0.1522</td>
      <td>0.1241</td>
      <td>0.6077</td>
      <td>0.7371</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_000a6266a</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>0.6280</td>
      <td>0.5817</td>
      <td>1.5540</td>
      <td>-0.0764</td>
      <td>-0.0323</td>
      <td>1.2390</td>
      <td>...</td>
      <td>-0.7250</td>
      <td>-0.6297</td>
      <td>0.6103</td>
      <td>0.0223</td>
      <td>-1.3240</td>
      <td>-0.3174</td>
      <td>-0.6417</td>
      <td>-0.2187</td>
      <td>-1.4080</td>
      <td>0.6931</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_0015fd391</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>-0.5138</td>
      <td>-0.2491</td>
      <td>-0.2656</td>
      <td>0.5288</td>
      <td>4.0620</td>
      <td>-0.8095</td>
      <td>...</td>
      <td>-2.0990</td>
      <td>-0.6441</td>
      <td>-5.6300</td>
      <td>-1.3780</td>
      <td>-0.8632</td>
      <td>-1.2880</td>
      <td>-1.6210</td>
      <td>-0.8784</td>
      <td>-0.3876</td>
      <td>-0.8154</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_001626bd3</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D2</td>
      <td>-0.3254</td>
      <td>-0.4009</td>
      <td>0.9700</td>
      <td>0.6919</td>
      <td>1.4180</td>
      <td>-0.8244</td>
      <td>...</td>
      <td>0.0042</td>
      <td>0.0048</td>
      <td>0.6670</td>
      <td>1.0690</td>
      <td>0.5523</td>
      <td>-0.3031</td>
      <td>0.1094</td>
      <td>0.2885</td>
      <td>-0.3786</td>
      <td>0.7125</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 876 columns</p>
</div>

Feature information is as follows: <br>

1)  **g-** signify gene expression data. <br>
2)  **c-** signify cell viability data. <br>
3)  **cp-type** represents the carrier through which cell was treated with the dose.<br>
4)  **cp_time** indicates treatment duration (24, 48, 72 hours)<br>
5)  **cp_dose** indicates dose (high or low)<br>
6)  **sig_id** represents unique identifier for each experiment.<br>

Description of features:

1) <b> Gene expression (g-) feature </b>: It is the process by which information from a gene is used in the synthesis of a functional gene product. These products are often proteins. In short, the mechanism of action of the 207 targets in this study will activate some genes, gene expression will take place and byproducts (proteins) will be synthesized.

2) <b> Cell viability (c-) feature </b>:A viability assay is an assay that is created to determine the ability of organs, cells or tissues to maintain or recover a state of survival. Viability can be distinguished from the all-or-nothing states of life and death by the use of a quantifiable index that ranges between the integers of 0 and 1 or, if more easily understood, the range of 0% and 100%. Viability can be observed through the physical properties of cells, tissues, and organs.

3) <b>cp-type feature </b>: indicates samples treated with a compound, trt_cp samples treated with the compounds.

4) <b>cp-time feature </b>: indicate treatment duration (24, 48, 72 hours)

5) <b>cp-dose feature </b>: indicate dose level.

6) <b>sig_id </b>: unique identifier for each sample.


```python
count1 = 0
count2 = 0
for i in features.columns:
    if 'g-' in i:
        count1+=1
    if 'c-' in i:
        count2+=1
    
print('There are total {} gene expressions '.format(count1))
print('There are total {} cell viability features '.format(count2))
```

    There are total 772 gene expressions 
    There are total 100 cell viability features 


lets check if there are any NaN in the dataset


```python
features.isnull().values.any()
```




    False



So there are no NaN values, we don't have to impute the data

lets check whether all the <b>sig_id</b> are unique


```python
features['sig_id'].nunique()
```




    23814


#### 1.2  Inspection of target columns and features.

lets check the general types of MoA's


```python
set([ i.split('_')[-1] for i in targets_scored.columns if len(i.split('_')[-1])>2])
```




    {'activator',
     'agent',
     'agonist',
     'analgesic',
     'antagonist',
     'anti-inflammatory',
     'antiarrhythmic',
     'antibiotic',
     'anticonvulsant',
     'antifolate',
     'antifungal',
     'antihistamine',
     'antimalarial',
     'antioxidant',
     'antiprotozoal',
     'antiviral',
     'blocker',
     'diuretic',
     'donor',
     'immunosuppressant',
     'inhibitor',
     'laxative',
     'local',
     'medium',
     'scavenger',
     'secretagogue',
     'sensitizer',
     'steroid',
     'stimulant'}



Above are the general categories to which the MoA's belong. 


```python
for i in targets_scored.columns:
    if len(i.split('_')[-1])<2:
        print(i)
```

    vitamin_b


Apart from that there is a MoA which belongs to vitamin category.


```python
targets_scored.isnull().values.any()
```




    False



So there are no NaN values in the target data.

# 2. Univariate Analysis 

#### 2.1 Univariate analysis of features.

lets have a look at categorical features first


```python
# cp_type feature
features['cp_type'].value_counts(normalize=True).plot(kind='bar')
```

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_45_1.png)

Most of the doses were give through <b>trt_cp</b> as compared to control pertubation treatements <b>ctl_vehicle</b> .<br>
But still <b>ctl_vehicle</b> have no MoA i-e drugs given through that vehicle do not activate or deactivate any genes .<br>
So we can actually write a condition which results in no MoA, if vehicle is <b>ctl_vehicle</b> .


```python
# cp_dose
features['cp_dose'].value_counts().plot(kind='bar')
```

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_47_1.png)

D1 vs D2, which encode high vs low doses. So approximately equal number of dosages belong to both of these categories.<br>
 Our data is balanced with respect to this feature.


```python
# cp_time feature
features['cp_time'].value_counts().plot(kind='bar')
```

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_49_1.png)

Three treatment duration categories of 24h, 48h, or 72h. Here also the data is balanced


```python
# gene expression features
grid_plot('g-10','g-100','g-200','g-400','g-500','g-600' )
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_51_0.png)

Most of the gene features are normally distributed although there is negligible amount of skewness present .

lets visualize the mean, min and max of all the gene expressions


```python
min_of_g = [ min(features[i]) for i in features.columns if 'g-' in i ]
max_of_g = [ max(features[i]) for i in features.columns if 'g-' in i ]
mean_of_g = [ features[i].mean() for i in features.columns if 'g-' in i ]
std_of_g = [ features[i].std() for i in features.columns if 'g-' in i ]
```


```python
grid_plot_stats(min_of_g, max_of_g, mean_of_g, std_of_g)
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_55_0.png)


a) As we can see most of the g- get activated and deactivated with similar max and min activations. <br>
b) The mean activation of gene distributions is normally distributed. <br>
c) Most of the gene expressions have activation with standard deviation around 1. Std. dev. is normally distributed.

```python
# cell viability features
grid_plot('c-10','c-20','c-30','c-40','c-50','c-60' )
```
![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_57_0.png)


All of them are skewed towards left side .


```python
min_of_c = [ min(features[i]) for i in features.columns if 'c-' in i ]
max_of_c = [ max(features[i]) for i in features.columns if 'c-' in i ]
mean_of_c = [ features[i].mean() for i in features.columns if 'c-' in i ]
std_of_c = [ features[i].std() for i in features.columns if 'c-' in i ]
```


```python
grid_plot_stats(min_of_c, max_of_c, mean_of_c, std_of_c)
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_60_0.png)


a) For most of the cell viability features min is towards **-10**. <br>
b) Max values are showing **bimodal distribution**. <br>
c) In last plot, we observed the distriution of cell viability is **left** skewed, beacuse of that the distribution means is shifted towards left side. <br>
d) Std. dev. is **left** skewed.

#### 2.2 Univariate analysis of target features

lets check the occurence of MoA's


```python
sum_of_MoA = [ sum(targets_scored[i])/len(targets_scored) for i in targets_scored.columns if i != 'sig_id' ]
```


```python
len(sum_of_MoA)
```




    206




```python
res = sorted(zip(targets_scored.columns[1:], sum_of_MoA), key = lambda x: x[1])
MoA, count = zip(*res)
```


```python
plt.figure(figsize=(7,7))
plt.scatter(count[-20:], MoA[-20:], color=sns.color_palette('Reds',20))
plt.title('Targets with higher presence in train samples', weight='bold', fontsize=15)
plt.xticks(weight='bold')
plt.yticks(weight='bold')
plt.xlabel('Count', fontsize=13)
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_67_0.png)


So MoA,  <b>nfkb_inhibitor</b>  has got higher presence, followed by  <b>proteasome_inhibitor</b>  and  <b>cyclooxygenase_inhibitor</b>

# 3.  Bivariate analysis

#### 3.1 Relation within features

Let's see correlation within gene expression features.


```python
g_cols = [col for col in features.columns if 'g-' in col]

genes=features[g_cols]
plt.figure(figsize=(15,7))

corr = genes.corr()
mask = np.zeros_like(corr)
mask[np.triu_indices_from(mask)] = True
sns.heatmap(corr, mask=mask, cmap='coolwarm', alpha=0.9)
plt.title('Gene expression: Correlation', fontsize=15, weight='bold')
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_72_0.png)

So there are certain red and blue pixels, which suggests that there is infact correlation between certain gene expressions . <br>

Lets narrow down the image and see correlation between subset of features.


```python
g_cols = [col for col in features.columns if 'g-' in col]

genes=features[g_cols[:30]]
plt.figure(figsize=(15,7))

corr = genes.corr()
mask = np.zeros_like(corr)
mask[np.triu_indices_from(mask)] = True
sns.heatmap(corr, mask=mask, cmap='coolwarm', alpha=0.9)
plt.title('Gene expression: Correlation', fontsize=15, weight='bold')
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_74_0.png)


1) So as per this subset **gene 8** and **gene 10** seems to be **positively correlated** with most of the genes,
which implies when these genes are active most of the other genes are active and vice versa.<br>
2) Similarly **gene 0** ,**gene 4** and **gene 13** hold **negative correlation** with most of other genes.
Which implies when these genes are active most of the other genes are inactive and vice versa.

Let's see correlation within cell viability features.

```python
c_cols = [col for col in features.columns if 'c-' in col]

cells=features[c_cols]
plt.figure(figsize=(15,7))

corr = cells.corr()
mask = np.zeros_like(corr)
mask[np.triu_indices_from(mask)] = True
sns.heatmap(corr, mask=mask, cmap='coolwarm', alpha=0.9)
plt.title('Cell viiability: Correlation', fontsize=15, weight='bold')
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_77_0.png)

Mostly all of the cells show positively correlated behaviour with each other. <br>
Expect cells 74, 58, 22 seem to be negatively correlated behaviour wiith other cells.

<b>Note</b>: The reason why cell viabiltiy shows such a strong correlation, is might be because the cell viability features are left skewed and that skewness in turn affects the correlation. Lets just see whether our guess is correct.


```python
features.plot.scatter(x='c-12', y='c-72')
```
![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_80_1.png)

As we can see there is lump of outliers towards bottom left corner in above plot.

#### 3.2 Relation between targets


```python
t_cols = targets_scored.columns[1:]
```


```python
targets=targets_scored[t_cols]
plt.figure(figsize=(15,7))

corr = targets.corr()
mask = np.zeros_like(corr)
mask[np.triu_indices_from(mask)] = True
sns.heatmap(corr, mask=mask, cmap='coolwarm', alpha=0.9)
plt.title('Cell viability: Correlation', fontsize=15, weight='bold')
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_84_0.png)

```python
corr_series = corr.unstack().sort_values(kind="quicksort", ascending=False)
corr_frame= pd.DataFrame(corr_series).reset_index()
corr_frame = corr_frame.rename(columns={0: 'correlation', 'level_0':'MoA 1', 'level_1': 'MoA 2'})
corr_frame= corr_frame[corr_frame['correlation'] != 1]
corr_frame = corr_frame.reset_index()
pos = [1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35]
corr_frame= corr_frame.drop(corr_frame.index[pos])
```


```python
corr_frame=corr_frame.drop('index', axis=1)
corr_frame
```

<div style="overflow-x: scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MoA 1</th>
      <th>MoA 2</th>
      <th>correlation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>proteasome_inhibitor</td>
      <td>nfkb_inhibitor</td>
      <td>0.921340</td>
    </tr>
    <tr>
      <th>2</th>
      <td>kit_inhibitor</td>
      <td>pdgfr_inhibitor</td>
      <td>0.915603</td>
    </tr>
    <tr>
      <th>4</th>
      <td>flt3_inhibitor</td>
      <td>kit_inhibitor</td>
      <td>0.758112</td>
    </tr>
    <tr>
      <th>6</th>
      <td>flt3_inhibitor</td>
      <td>pdgfr_inhibitor</td>
      <td>0.705119</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>42227</th>
      <td>nfkb_inhibitor</td>
      <td>serotonin_receptor_antagonist</td>
      <td>-0.024995</td>
    </tr>
    <tr>
      <th>42228</th>
      <td>dopamine_receptor_antagonist</td>
      <td>nfkb_inhibitor</td>
      <td>-0.025617</td>
    </tr>
    <tr>
      <th>42229</th>
      <td>nfkb_inhibitor</td>
      <td>dopamine_receptor_antagonist</td>
      <td>-0.025617</td>
    </tr>
  </tbody>
</table>
<p>42212 rows × 3 columns</p>
</div>

1) **nfkb_inhibitor** and **proteasome_inhibitor** have +0.9 correlation and are highly presented in the samples. <br>
2) **Kit_inhibtor** is highly correlated with 2 targets: **pdgfr_inhibitor** and **flt3_inhibitor**.

The samples having more than 2 MoA targets most probably include those 4 target pairs.

#### 3.3 Relation between features

lets see effect of drug on gene expression.


```python
with_out_drug = features[features['cp_type']=='ctl_vehicle']
```


```python
with_drug = features[features['cp_type']=='trt_cp']
```

<details>
        <summary>Code</summary>

        {% highlight ruby %}
        
        plt.style.use('seaborn')
        sns.set_style('whitegrid')
        fig = plt.figure(figsize=(15,5))

        ax1 = plt.subplot2grid((1,2),(0,0))
        plt.hist(with_out_drug['g-10'], bins=4, color='mediumpurple', alpha=0.5)
        plt.title(f'control: g-10', weight='bold', fontsize=18)

        ax1 = plt.subplot2grid((1,2),(0,1))
        plt.hist(with_drug['g-10'], bins=4, color='darkcyan', alpha=0.5)
        plt.title(f'Treated with drugs: g-10', weight='bold', fontsize=18)
        plt.show()
        
        {% endhighlight %}
</details>

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_93_0.png)

The distribution of activations of <b>g-10</b> seems very different in both the situations.
lets see some more examples


<details>
        <summary>Code</summary>

{% highlight ruby %}
    
    plt.style.use('seaborn')
    sns.set_style('whitegrid')
    fig = plt.figure(figsize=(15,5))

    ax1 = plt.subplot2grid((1,2),(0,0))
    plt.hist(with_out_drug['g-500'], bins=4, color='mediumpurple', alpha=0.5)
    plt.title(f'control: g-500', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,2),(0,1))
    plt.hist(with_drug['g-500'], bins=4, color='darkcyan', alpha=0.5)
    plt.title(f'Treated with drugs: g-500', weight='bold', fontsize=18)


    plt.style.use('seaborn')
    sns.set_style('whitegrid')
    fig = plt.figure(figsize=(15,5))

    ax1 = plt.subplot2grid((1,2),(0,0))
    plt.hist(with_out_drug['g-700'], bins=4, color='mediumpurple', alpha=0.5)
    plt.title(f'control: g-700', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,2),(0,1))
    plt.hist(with_drug['g-700'], bins=4, color='darkcyan', alpha=0.5)
    plt.title(f'Treated with drugs: g-700', weight='bold', fontsize=18)
    plt.show()


{% endhighlight %}
</details>

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_95_0.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_95_1.png)

In both of the above plots effect of drugs on gene expression is visible through change in distributions

lets see effect of drug treatment time on gene expression 


```python
drug_24_hrs = with_drug[with_drug['cp_time']==24]
drug_48_hrs = with_drug[with_drug['cp_time']==48]
drug_72_hrs = with_drug[with_drug['cp_time']==72]
```


<details>
        <summary>Code</summary>

{% highlight ruby %}
def plot_feature_with_duration(f):
    plt.style.use('seaborn')
    sns.set_style('whitegrid')
    fig = plt.figure(figsize=(15,5))

    ax1 = plt.subplot2grid((1,3),(0,0))
    plt.hist(drug_24_hrs[f], bins=4, color='green', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 24 hrs', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,3),(0,1))
    plt.hist(drug_48_hrs[f], bins=4, color='blue', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 48 hrs', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,3),(0,2))
    plt.hist(drug_72_hrs[f], bins=4, color='red', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 72 hrs', weight='bold', fontsize=18)

    return plt.show()
{% endhighlight %}
</details>


```python
plot_feature_with_duration('g-10')
plot_feature_with_duration('g-250')
plot_feature_with_duration('g-500')
```

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_100_0.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_100_1.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_100_2.png)

As show above, as the dosage duration changes the distribution of gene expression varies a lot.

 lets see effect of drug level and duration on gene expression .

```python
high_drug_24_hrs = with_drug[(with_drug['cp_time']==24) & (with_drug['cp_dose']=='D1')]
high_drug_48_hrs = with_drug[(with_drug['cp_time']==48) & (with_drug['cp_dose']=='D1')]
high_drug_72_hrs = with_drug[(with_drug['cp_time']==72) & (with_drug['cp_dose']=='D1')]

low_drug_24_hrs = with_drug[(with_drug['cp_time']==24) & (with_drug['cp_dose']=='D2')]
low_drug_48_hrs = with_drug[(with_drug['cp_time']==48) & (with_drug['cp_dose']=='D2')]
low_drug_72_hrs = with_drug[(with_drug['cp_time']==72) & (with_drug['cp_dose']=='D2')]
```

<details>
        <summary>Code</summary>

{% highlight ruby %}

def plot_feature_with_duration_level(f):
    plt.style.use('seaborn')
    sns.set_style('whitegrid')
    fig = plt.figure(figsize=(15,5))

    ax1 = plt.subplot2grid((1,3),(0,0))
    plt.hist(high_drug_24_hrs[f], bins=4, color='red', alpha=0.5)
    plt.hist(low_drug_24_hrs[f], bins=4, color='green', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 24 hrs', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,3),(0,1))
    plt.hist(high_drug_48_hrs[f], bins=4, color='red', alpha=0.5)
    plt.hist(low_drug_48_hrs[f], bins=4, color='green', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 48 hrs', weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,3),(0,2))
    plt.hist(high_drug_72_hrs[f], bins=4, color='red', alpha=0.5)
    plt.hist(low_drug_72_hrs[f], bins=4, color='green', alpha=0.5)
    plt.title(f'feature: '+f+', duration: 72 hrs', weight='bold', fontsize=18)

    return plt.show()
{% endhighlight %}
</details>


```python
plot_feature_with_duration_level('g-10')
plot_feature_with_duration_level('g-250')
plot_feature_with_duration_level('g-500')
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_105_0.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_105_1.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_105_2.png)

<b> Red </b> signifies high level dose and <b> Green </b> signifies low level dose <br>
1) The distributions at high ad loow dosages overlap a lot.

#### 3.4 Relation between features and targets


```python
targets_scored[targets_scored.columns[1:]].sum(axis=1).value_counts().plot(kind='bar')
```




![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_116_1.png)


Most of the samples are with MoA count 1 


```python
MoA_count_cat = list([])
for i in targets_scored[targets_scored.columns[1:]].sum(axis=1):
    if i==0:
        MoA_count_cat.append('0')
    if i==1:
        MoA_count_cat.append('1')   
    if i==2:
        MoA_count_cat.append('2')
    elif i>2:
        MoA_count_cat.append('3+')
```


```python
MoA_count_cat = pd.DataFrame(list(zip(list(targets_scored['sig_id']), MoA_count_cat)), columns =['sig_id', 'Moa_count_cat'])
```


```python
features = features.merge(MoA_count_cat, how='left', on='sig_id')
```

 lets see relation between targets and drug level 


```python
high_drug_MoA_cat = features[features['cp_dose']=='D1']['Moa_count_cat']
low_drug_MoA_cat = features[features['cp_dose']=='D2']['Moa_count_cat']
```

<details>
        <summary>Code</summary>

{% highlight ruby %}

plt.style.use('seaborn')
sns.set_style('whitegrid')
fig = plt.figure(figsize=(15,5))

ax1 = plt.subplot2grid((1,2),(0,0))
plt.hist(high_drug_MoA_cat, color='red', alpha=0.5)
plt.title(f'high drugs', weight='bold', fontsize=18)

ax1 = plt.subplot2grid((1,2),(0,1))
plt.hist(low_drug_MoA_cat, color='blue', alpha=0.5)
plt.title(f'low drugs', weight='bold', fontsize=18)
plt.show()

{% endhighlight %}
</details>

![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_123_0.png)


In both high ad low level of drugs dosage, MoA count 1 add 0 domiates. There are few occasions when more than 2 MoA
occured.

lets see relation between targets and dosage duration 


```python
hours_24_MoA_cat = features[features['cp_time']==24]['Moa_count_cat']
hours_48_MoA_cat = features[features['cp_time']==48]['Moa_count_cat']
hours_72_MoA_cat = features[features['cp_time']==72]['Moa_count_cat']
```


<details>
        <summary>Code</summary>

{% highlight ruby %}
plt.style.use('seaborn')
sns.set_style('whitegrid')
fig = plt.figure(figsize=(15,5))

ax1 = plt.subplot2grid((1,3),(0,0))
plt.hist(hours_24_MoA_cat, color='red', alpha=0.5)
plt.title(f'duration 24 hours', weight='bold', fontsize=18)

ax1 = plt.subplot2grid((1,3),(0,1))
plt.hist(hours_48_MoA_cat, color='blue', alpha=0.5)
plt.title(f'duration 48 hours', weight='bold', fontsize=18)

ax1 = plt.subplot2grid((1,3),(0,2))
plt.hist(hours_72_MoA_cat, color='green', alpha=0.5)
plt.title(f'duration 72 hours', weight='bold', fontsize=18)

plt.show()
{% endhighlight %}
</details>


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_127_0.png)

1) In all of the dosage durations MoA count 0 and 1 dominates followed by 2 ad 3

lets see relation between targets and gene expression distribution 


```python
Moa_count_cat_0 = features[features['Moa_count_cat']=='0']
Moa_count_cat_1 = features[features['Moa_count_cat']=='1']
Moa_count_cat_2 = features[features['Moa_count_cat']=='2']
Moa_count_cat_3 = features[features['Moa_count_cat']=='3+']
```


<details>
        <summary>Code</summary>

{% highlight ruby %}
def plot_feature_with_Moa_count_cat(f):
    plt.style.use('seaborn')
    sns.set_style('whitegrid')
    fig = plt.figure(figsize=(20,5))

    ax1 = plt.subplot2grid((1,4),(0,0))
    plt.hist(Moa_count_cat_0[f], color='red', alpha=0.5)
    plt.title('MoA count 0, feature: '+f, weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,4),(0,1))
    plt.hist(Moa_count_cat_1[f], color='blue', alpha=0.5)
    plt.title('MoA count 1, feature: '+f, weight='bold', fontsize=18)

    ax1 = plt.subplot2grid((1,4),(0,2))
    plt.hist(Moa_count_cat_2[f], color='green', alpha=0.5)
    plt.title('MoA count 2, feature: '+f, weight='bold', fontsize=18)
    
    ax1 = plt.subplot2grid((1,4),(0,3))
    plt.hist(Moa_count_cat_3[f], color='pink', alpha=0.5)
    plt.title('MoA count >= 3, feature: '+f, weight='bold', fontsize=18)

    return plt.show()
{% endhighlight %}
</details>


```python
plot_feature_with_Moa_count_cat('g-0')
plot_feature_with_Moa_count_cat('g-300')
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_132_0.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_132_1.png)

1) The distribution of gene expressions MoA count 0, 1, 3 seems to be narrow . <br>
2) The distribution of gene expressions MoA count 2 seems to be wide . <br>
3) We can say that when there are less MoA actvations most of the gene expressions remain concentrated. <br>
4) When there are more gene activations, the gene expressions are widely distributed.

 lets see relation between targets and cell viability distribution 


```python
plot_feature_with_Moa_count_cat('c-0')
plot_feature_with_Moa_count_cat('c-80')
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_135_0.png)



![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_135_1.png)


1) The distribution of cell viability feature MoA count 0 and 1 seems to be following narrow distribution. <br>
2) The distribution of cell viability feature MoA count 2 seems to be following wide distribution.

# 4. PCA

#### 4.1  PCA on gene expression.


```python
from sklearn.decomposition import PCA
```


```python
pca = PCA(n_components=2)
```


```python
cols = [ col for col in features.columns if 'g-' in col ]
```


```python
genes_trasformed = pca.fit_transform(features[cols].values)
```


```python
genes_trasformed
```




    array([[ -8.27039603,  -0.44112646],
           [ -6.62560814,   3.42833735],
           [ -1.72725065,   2.33645648],
           ...,
           [ -6.57892286,  -1.34231503],
           [  7.50955722, -20.86674869],
           [  2.72771011,   4.66340611]])




<details>
        <summary>Code for PCA</summary>

{% highlight ruby %}
def plot_PCA(x, y, labels):
    fig, ax = plt.subplots()

    colormap = cm.viridis
    unique_labels = list(set(labels))
    color_palette = [colors.rgb2hex(colormap(i)) for i in np.linspace(0, 0.9, len(unique_labels))]

    
    color_dict = dict() 

    for color, label in zip(color_palette, unique_labels):
        color_dict[label] = color
    

    color_list = [ color_dict[i] for i in labels ]

    plt.scatter(x, y,
            c=color_list, edgecolor='none', alpha=0.5,
            )
    
    patches = [ mpatches.Patch(color=value, label=key) for key, value in color_dict.items() ]

    plt.legend(handles = patches)
    return plt.show()

{% endhighlight %}
</details>

 lets see "Moa_count_cat" i-e MoA count features distribution with PCA vectors of gene expression. 


```python
plot_PCA(list(genes_trasformed.T[0]), list(genes_trasformed.T[1]), list(features['Moa_count_cat']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_146_0.png)

1) Most of the genes samples with 2 MoA are towards right side in the plot but they are sparsely placed. <br>
2) Gene samples with count 3, 1 and 2 are concentrated towards left side.

lets see "cp_time" i-e Dosage duration count features distribution with PCA vectors of gene expression 


```python
plot_PCA(list(genes_trasformed.T[0]), list(genes_trasformed.T[1]), list(features['cp_time']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_149_0.png)


1) Most of the dosage of 24 hours duration lie at bottom of the plot forming a cluster. <br>
2) Dosages of duration 48 and 72 hours are sparsely distributed

 lets see "cp_dose" i-e Dosage duration count features distribution with PCA vectors of gene expression 


```python
plot_PCA(list(genes_trasformed.T[0]), list(genes_trasformed.T[1]), list(features['cp_dose']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_152_0.png)


1) There are no clear clusters here.

#### 4.2  PCA on cell viability 


```python
cols = [ col for col in features.columns if 'c-' in col ]
```


```python
cells_trasformed = pca.fit_transform(features[cols].values)
```


```python
cells_trasformed
```




    array([[-7.33992069,  0.60099038],
           [-7.4773736 , -0.75247805],
           [-2.30350659,  0.22193864],
           ...,
           [-8.35785114,  0.46543437],
           [-7.89501453,  0.16325937],
           [25.12325042,  3.49027281]])

 lets see "Moa_count_cat" i-e MoA count features distribution with PCA vectors of cell viability 


```python
plot_PCA(list(cells_trasformed.T[0]), list(cells_trasformed.T[1]), list(features['Moa_count_cat']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_159_0.png)


1) Cell viability with MoA count 2 is clustered at bottom right corner.<br>
2) Cell viability with MoA cout 0,1 ad 3 are sparsely placed. 

 lets see "cp_time" i-e Dosage duration count features distribution with PCA vectors of cell viability 


```python
plot_PCA(list(cells_trasformed.T[0]), list(cells_trasformed.T[1]), list(features['cp_time']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_162_0.png)


1) Cell viability with dosage duratio of 24 hours is clustered at bottom .<br>
2) Cell viability with other dosage durations is sparsely oriented.

 lets see "cp_dose" i-e Dosage duration count features distribution with PCA vectors of cell viability 


```python
plot_PCA(list(cells_trasformed.T[0]), list(cells_trasformed.T[1]), list(features['cp_dose']))
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_165_0.png)


1) There are no clear clusters here.

# 5. Non-scored targets


```python
sum_of_MoA = [ sum(targets_non_scored[i]) for i in targets_non_scored.columns if i != 'sig_id' ]
res = sorted(zip(targets_non_scored.columns[1:], sum_of_MoA), key = lambda x: x[1])
MoA, count = zip(*res)
```


```python
plt.figure(figsize=(7,7))
plt.scatter(count[-20:], MoA[-20:], color=sns.color_palette('Reds',20))
plt.title('Targets with higher presence in train samples', weight='bold', fontsize=15)
plt.xticks(weight='bold')
plt.yticks(weight='bold')
plt.xlabel('Count', fontsize=13)
plt.show()
```


![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_174_0.png)


In non scored targets ace_inhibitor has got highest occurence, followed by purinergic_receptor_antagonist.


```python
targets_non_scored[targets_non_scored.columns[1:]].sum(axis=1).value_counts().plot(kind='bar')
```




    <matplotlib.axes._subplots.AxesSubplot at 0x7fb10d664110>




![png]({{ site.baseurl }}/assets/images/MoA_inner_assets/output_176_1.png)


As we can see in above plot most of the non scored samples have 0 MoA. We will neglect this file from further analysis

# 6. EDA for MoA activated or not

We already know that all of the cells which were given drug through <b>ctl_vehicle</b> did not genrate MoA. Lets try to find out if there is any way to segregate between samples with no MoA activation and one with MoA activation if the vehicle is <b>trt_cp</b>.


```python
MoA_active = [False if i=='0' else True for i in features['Moa_count_cat']]
```


```python
features['MoA_active'] = MoA_active
```


```python
features.head()
```

<div style="overflow-x: scroll;">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sig_id</th>
      <th>cp_type</th>
      <th>cp_time</th>
      <th>cp_dose</th>
      <th>g-0</th>
      <th>g-1</th>
      <th>g-2</th>
      <th>g-3</th>
      <th>g-4</th>
      <th>g-5</th>
      <th>...</th>
      <th>c-92</th>
      <th>c-93</th>
      <th>c-94</th>
      <th>c-95</th>
      <th>c-96</th>
      <th>c-97</th>
      <th>c-98</th>
      <th>c-99</th>
      <th>Moa_count_cat</th>
      <th>MoA_active</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_000644bb2</td>
      <td>trt_cp</td>
      <td>24</td>
      <td>D1</td>
      <td>1.0620</td>
      <td>0.5577</td>
      <td>-0.2479</td>
      <td>-0.6208</td>
      <td>-0.1944</td>
      <td>-1.0120</td>
      <td>...</td>
      <td>0.8076</td>
      <td>0.5523</td>
      <td>-0.1912</td>
      <td>0.6584</td>
      <td>-0.3981</td>
      <td>0.2139</td>
      <td>0.3801</td>
      <td>0.4176</td>
      <td>1</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_000779bfc</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D1</td>
      <td>0.0743</td>
      <td>0.4087</td>
      <td>0.2991</td>
      <td>0.0604</td>
      <td>1.0190</td>
      <td>0.5207</td>
      <td>...</td>
      <td>0.4708</td>
      <td>0.0230</td>
      <td>0.2957</td>
      <td>0.4899</td>
      <td>0.1522</td>
      <td>0.1241</td>
      <td>0.6077</td>
      <td>0.7371</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_000a6266a</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>0.6280</td>
      <td>0.5817</td>
      <td>1.5540</td>
      <td>-0.0764</td>
      <td>-0.0323</td>
      <td>1.2390</td>
      <td>...</td>
      <td>0.6103</td>
      <td>0.0223</td>
      <td>-1.3240</td>
      <td>-0.3174</td>
      <td>-0.6417</td>
      <td>-0.2187</td>
      <td>-1.4080</td>
      <td>0.6931</td>
      <td>3+</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_0015fd391</td>
      <td>trt_cp</td>
      <td>48</td>
      <td>D1</td>
      <td>-0.5138</td>
      <td>-0.2491</td>
      <td>-0.2656</td>
      <td>0.5288</td>
      <td>4.0620</td>
      <td>-0.8095</td>
      <td>...</td>
      <td>-5.6300</td>
      <td>-1.3780</td>
      <td>-0.8632</td>
      <td>-1.2880</td>
      <td>-1.6210</td>
      <td>-0.8784</td>
      <td>-0.3876</td>
      <td>-0.8154</td>
      <td>0</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_001626bd3</td>
      <td>trt_cp</td>
      <td>72</td>
      <td>D2</td>
      <td>-0.3254</td>
      <td>-0.4009</td>
      <td>0.9700</td>
      <td>0.6919</td>
      <td>1.4180</td>
      <td>-0.8244</td>
      <td>...</td>
      <td>0.6670</td>
      <td>1.0690</td>
      <td>0.5523</td>
      <td>-0.3031</td>
      <td>0.1094</td>
      <td>0.2885</td>
      <td>-0.3786</td>
      <td>0.7125</td>
      <td>1</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 878 columns</p>
</div>



lets check if there is any correlation between our categorical variables and <b>MoA_active</b> feature

```python
from collections import Counter
import math
import scipy.stats as ss
```


<details>
        <summary>Code for Categorical correlation</summary>

{% highlight ruby %}

# reference: https://towardsdatascience.com/the-search-for-categorical-correlation-a1cf7f1888c9

# theilu correlation between categorical variables
def conditional_entropy(x,y):
    # entropy of x given y
    y_counter = Counter(y)
    xy_counter = Counter(list(zip(x,y)))
    total_occurrences = sum(y_counter.values())
    entropy = 0
    for xy in xy_counter.keys():
        p_xy = xy_counter[xy] / total_occurrences
        p_y = y_counter[xy[1]] / total_occurrences
        entropy += p_xy * math.log(p_y/p_xy)
    return entropy

def theil_u(x,y):
    s_xy = conditional_entropy(x,y)
    x_counter = Counter(x)
    total_occurrences = sum(x_counter.values())
    p_x = list(map(lambda n: n/total_occurrences, x_counter.values()))
    s_x = ss.entropy(p_x)
    if s_x == 0:
        return 1
    else:
        return (s_x - s_xy) / s_x
{% endhighlight %}
</details>



```python
theil_u(features['cp_time'].tolist(), features['Moa_count_cat'].tolist())
```




    4.095894564328272e-06




```python
theil_u(features['cp_type'].tolist(), features['Moa_count_cat'].tolist())
```




    0.285150967263478




```python
theil_u(features['cp_dose'].tolist(), features['Moa_count_cat'].tolist())
```




    3.574176402579373e-06


The correlation between categorical variables and our <b>MoA_active</b> is not much stronger


<details>
        <summary>Code for correlation between categorical and continuous variable</summary>
{% highlight ruby %}

def correlation_ratio(categories, measurements):
    fcat, _ = pd.factorize(categories)
    cat_num = np.max(fcat)+1
    y_avg_array = np.zeros(cat_num)
    n_array = np.zeros(cat_num)
    for i in range(0,cat_num):
        cat_measures = measurements[np.argwhere(fcat == i).flatten()]
        n_array[i] = len(cat_measures)
        y_avg_array[i] = np.average(cat_measures)
    y_total_avg = np.sum(np.multiply(y_avg_array,n_array))/np.sum(n_array)
    numerator = np.sum(np.multiply(n_array,np.power(np.subtract(y_avg_array,y_total_avg),2)))
    denominator = np.sum(np.power(np.subtract(measurements,y_total_avg),2))
    if numerator == 0:
        eta = 0.0
    else:
        eta = np.sqrt(numerator/denominator)
    return eta

{% endhighlight %}
</details>


```python
corrs = list([])
for i in g_cols:
    corr= correlation_ratio(features['MoA_active'], features[i])
    corrs.append(corr)
```


```python
max(corrs)
```




    0.1934384629317824




```python
corrs = list([])
for i in c_cols:
    corr= correlation_ratio(features['MoA_active'], features[i])
    corrs.append(corr)
```


```python
max(corrs)
```




    0.1530758539280619


The correlation between continuous variables and our <b>MoA_active</b> is not much stronger.


|Blog part| 
|----------|
|1. [MoA problem definition link]({{ site.baseurl }}{% post_url /2021-02-22-MoA %})|
|----------|
|3. [Feature Engineering and Baseline model for MoA]({{ site.baseurl }}{% post_url /MoA_inner_posts/2021-02-22-MoA_Feature_Eng_Baseline %})|
|-------------------|
|4. [ML techniques on MoA dataset]({{ site.baseurl }}{% post_url /MoA_inner_posts/2021-02-22-MoA_ML %})

